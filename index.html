<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPY×ACADEMY</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <img src="logo.png" alt="ICT PARK" class="logo">
    <h1 class="title"></h1>
    <div id="initialScreen">
        <div class="initial-message">
            <span class="shake-text">パ</span>スワードを入力してください。
        </div>
        <div class="input-group">
            <input type="text" id="initialInput" placeholder="パスワードを入力">
            <button id="submitButton">確認</button>
        </div>
    </div>
    <div id="mainScreen" style="display: none;">
        <div id="message1" class="message"></div>
        <div id="message2" class="message"></div>
        <div id="message3" class="message"></div>
        <button id="startButton" class="button">ステージ1へ</button>
    </div>

    <script>
        const messages = [
            'ようこそ、SPY×ACADEMYへ！',
            '5つのステージをクリアして隠されたメッセージを探せ。',
            'Ready?'
        ];

        const stage1Message = 'この画面のどこかに一つ目のパスワードが隠されている。\nよーく観察して、パスワードを見つけ出せ！';
        
        const stage2Message = [
            'ステージ1クリア！',
            'インターネットは、世界中のコンピュータをつなぐ巨大なネットワーク。',
            'まるで世界中に張り巡らされた道路のように、\n情報が行き交っているんだ。',
            'でも、その道筋はどうやって決まるんだろう？'
        ];

        function typeWriter(text, element, callback) {
            element.style.opacity = "1";
            let i = 0;
            const speed = 30;

            function type() {
                if (i < text.length) {
                    if (text.charAt(i) === '\n') {
                        element.innerHTML += '<br>';
                    } else {
                        element.innerHTML += text.charAt(i);
                    }
                    i++;
                    setTimeout(type, speed);
                } else if (callback) {
                    setTimeout(callback, 1000);
                }
            }
            type();
        }

        window.onload = function() {
            const titleElement = document.querySelector('.title');
            const message1 = document.getElementById('message1');
            const message2 = document.getElementById('message2');
            const message3 = document.getElementById('message3');
            const startButton = document.getElementById('startButton');
            const initialScreen = document.getElementById('initialScreen');
            const mainScreen = document.getElementById('mainScreen');
            const shakeText = document.querySelector('.shake-text');

            titleElement.innerHTML = 'SPY<span>×</span>ACADEMY';
            
            setInterval(() => {
                shakeText.classList.add('shaking');
                setTimeout(() => {
                    shakeText.classList.remove('shaking');
                }, 500);
            }, 3000);

            shakeText.addEventListener('click', () => {
                initialScreen.style.display = 'none';
                mainScreen.style.display = 'block';
                
                setTimeout(() => {
                    titleElement.classList.add('visible');
                    
                    setTimeout(() => {
                        typeWriter(messages[0], message1, () => {
                            typeWriter(messages[1], message2, () => {
                                typeWriter(messages[2], message3, () => {
                                    startButton.style.display = 'block';
                                });
                            });
                        });
                    }, 3000);
                }, 1500);
            });

            startButton.addEventListener('click', () => {
                message1.style.display = 'none';
                message2.style.display = 'none';
                message3.style.display = 'none';
                startButton.style.display = 'none';

                titleElement.classList.add('moved');

                setTimeout(() => {
                    // ランダムな位置を計算
                    const getRandomPosition = () => {
                        // 画面の有効範囲を取得（上部20%から下部90%まで）
                        const maxWidth = window.innerWidth - 100; // 右端の余白
                        const minHeight = window.innerHeight * 0.2; // 上部20%から
                        const maxHeight = window.innerHeight * 0.9; // 下部90%まで

                        return {
                            left: Math.random() * maxWidth,
                            top: minHeight + (Math.random() * (maxHeight - minHeight))
                        };
                    };

                    // 隠しパスワードを追加
                    const hiddenPassword = document.createElement('div');
                    hiddenPassword.className = 'hidden-password';
                    hiddenPassword.textContent = 'ABC';
                    const position = getRandomPosition();
                    hiddenPassword.style.left = `${position.left}px`;
                    hiddenPassword.style.top = `${position.top}px`;
                    document.body.appendChild(hiddenPassword);

                    message1.style.display = 'block';
                    message1.innerHTML = '';
                    typeWriter(stage1Message, message1, () => {
                        const inputGroup = document.createElement('div');
                        inputGroup.className = 'input-group';

                        const passwordInput = document.createElement('input');
                        passwordInput.type = 'text';
                        passwordInput.className = 'password-input';
                        passwordInput.placeholder = 'パスワードを入力';

                        const submitButton = document.createElement('button');
                        submitButton.className = 'submit-button';
                        submitButton.textContent = '確認';

                        // パスワード確認のイベントリスナーを追加
                        submitButton.addEventListener('click', () => {
                            if (verifyPassword(passwordInput.value)) {
                                showStage2();
                            } else {
                                passwordInput.value = '';
                                passwordInput.placeholder = '不正解...もう一度試してみよう';
                                setTimeout(() => {
                                    passwordInput.placeholder = 'パスワードを入力';
                                }, 2000);
                            }
                        });

                        // Enterキーでも送信できるように
                        passwordInput.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                submitButton.click();
                            }
                        });

                        inputGroup.appendChild(passwordInput);
                        inputGroup.appendChild(submitButton);
                        message1.parentNode.appendChild(inputGroup);
                    });
                }, 2000);
            });
        }

        function showStage2() {
            const messages = document.querySelectorAll('.message');
            messages.forEach(msg => msg.innerHTML = '');
            
            const inputGroup = document.querySelector('.input-group');
            if (inputGroup) inputGroup.remove();
            
            const hiddenPassword = document.querySelector('.hidden-password');
            if (hiddenPassword) hiddenPassword.remove();

            // メッセージを順番に表示
            typeWriter(stage2Message[0], message1, () => {
                typeWriter(stage2Message[1], message2, () => {
                    typeWriter(stage2Message[2], message3, () => {
                        // ここに次のステージへの遷移ボタンや入力フォームを追加
                    });
                });
            });
        }

        // パスワード検証関数
        function verifyPassword(input) {
            return input.trim().toUpperCase() === 'ABC';
        }
    </script>
</body>
</html>
